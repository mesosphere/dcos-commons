<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">







<head>
<title>Elastic: Configuring</title>
<link rel="stylesheet" type="text/css" media="all" href="../../style/gh-basic.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="../../style/Dropdown.css" />
<script src="../../style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
#markdown-toc ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="../..">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="../..">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      <li><a href="../../operations-guide.html">SDK Operations Guide</a></li>
      
      <li><a href="../../developer-guide.html">SDK Developer Guide</a></li>
      
      <li><a href="../../yaml-reference.html">YAML Reference</a></li>
      
      <li><a href="../../glossary.html">Glossary</a></li>
      
      <li><a href="../../faq.html">Frequently Asked Questions</a></li>
      
      <li><a href="../../ops-guide"></a></li>
      
      <li><a href="../../swagger-api">REST APIs</a></li>
      <li><a href="../../api">Javadoc Reference</a></li>
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="../../tutorials/kafka-tutorial.html">Kafka Tutorial</a></li>
      
      <li><a href="../../tutorials/quick-start-java.html">Quick Start (Java)</a></li>
      
      <li><a href="../../tutorials/data-store-tutorial.html">Data Store Tutorial</a></li>
      
      <li><a href="../../tutorials/automatic-repair.html">Automatic Repair</a></li>
      
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          <li><a href="../../services/elastic/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/elastic/quick-start.html">Usage Example</a></li>
          
          <li><a href="../../services/elastic/upgrade.html">Upgrade</a></li>
          
          <li><a href="../../services/elastic/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/elastic/configure.html">Configuring</a></li>
          
          <li><a href="../../services/elastic/connecting.html">Connecting Clients</a></li>
          
          <li><a href="../../services/elastic/backup_restore.html">Backup and Restore</a></li>
          
          <li><a href="../../services/elastic/managing.html">Managing</a></li>
          
          <li><a href="../../services/elastic/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/elastic/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/elastic/version_policy.html">Version Policy</a></li>
          
          <li><a href="../../services/elastic/limitations.html">Limitations</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          <li><a href="../../services/hdfs/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/hdfs/quick-start.html">Usage Example</a></li>
          
          <li><a href="../../services/hdfs/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/hdfs/configure.html">Configuring</a></li>
          
          <li><a href="../../services/hdfs/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/hdfs/managing.html">Managing</a></li>
          
          <li><a href="../../services/hdfs/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/hdfs/troubleshooting.html">Troubleshooting</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          <li><a href="../../services/kafka/install-and-customize.html">Install and Customize</a></li>
          
          <li><a href="../../services/kafka/quick-start.html">Kick the Tires</a></li>
          
          <li><a href="../../services/kafka/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/kafka/configure.html">Configure</a></li>
          
          <li><a href="../../services/kafka/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/kafka/managing.html">Managing</a></li>
          
          <li><a href="../../services/kafka/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/kafka/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/kafka/version-policy.html">Version Policy</a></li>
          
          <li><a href="../../services/kafka/limitations.html">Limitations</a></li>
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Elastic: Configuring</h1>
<div id="content">
<h1 id="changing-configuration-at-runtime">Changing Configuration at Runtime</h1>

<p>You can customize your cluster in-place when it is up and running. These are the general steps to follow:</p>

<ol>
  <li>View your DC/OS dashboard at <code class="highlighter-rouge">http://$DCOS_URI/#/services/overview</code></li>
  <li>In the list of <code class="highlighter-rouge">Applications</code>, click the name of the Elastic service to be updated.</li>
  <li>Within the Elastic instance details view, click the <code class="highlighter-rouge">Configuration</code> tab, then click <code class="highlighter-rouge">Edit</code>.</li>
  <li>In the dialog that appears, expand the <code class="highlighter-rouge">Environment Variables</code> section and update any field(s) to their desired value(s). For example, to increase the number of data nodes, edit the value for <code class="highlighter-rouge">DATA_NODE_COUNT</code>. Do not edit the value for <code class="highlighter-rouge">FRAMEWORK_NAME</code>, <code class="highlighter-rouge">MASTER_NODE_TRANSPORT_PORT</code>, or any of the disk type/size fields.</li>
  <li>Click <code class="highlighter-rouge">Change and deploy configuration</code> to apply any changes and cleanly reload the Elastic service scheduler. The Elastic cluster itself will persist across the change.</li>
</ol>

<h1 id="configuration-guidelines">Configuration Guidelines</h1>

<ul>
  <li>Service name: This needs to be unique for each instance of the service that is running. It is also used as your cluster name.</li>
  <li>Service user. This must be a non-root user that already exists on each agent. The default user for CoreOS-based clusters is core.</li>
  <li>Plugins: X-Pack will already be installed for you, but you can specify other plugins via a comma-separated list of plugin names (e.g., “analysis-icu”) or plugin URIs.</li>
  <li>CPU/RAM/Disk/Heap: These will be specific to your DC/OS cluster and your Elasticsearch use cases. Please refer to Elastic’s guidelines for configuration.</li>
  <li>Node counts: At least 1 data node is required for the cluster to operate at all. You do not need to use a coordinator node unless you are using Kibana. There is no maximum for node counts.</li>
  <li>If you are running Kibana, make sure you have exactly 1 proxylite task running. Pick an available port for it to listen on. If you are not running Kibana, do not run a proxylite task.</li>
  <li>Master transport port: You can pick whichever port works for your DC/OS cluster. The default is 9300. If you want multiple master nodes from different clusters on the same host, specify different master HTTP and transport ports for each cluster. If you want to ensure a particular distribution of nodes of one task type (e.g., master nodes spread across 3 racks, data nodes on one class of machines), specify this via the Marathon placement constraint.</li>
  <li>Serial vs Parallel deployment. By default, the DC/OS Elastic Service tells DC/OS to install and update everything in parallel. You can change this to serial in order to have each node installed one at a time.</li>
</ul>

<h2 id="immutable-settings-at-cluster-creation-time-via-elastic-package-ui-or-json-options-file-via-cli">Immutable settings (at cluster creation time via Elastic package UI or JSON options file via CLI)</h2>

<p>These setting cannot be changed after installation.</p>

<ul>
  <li>Service name (aka cluster name). Can be hyphenated, but not underscored.</li>
  <li>Master transport port.</li>
  <li>Disk sizes/types.</li>
</ul>

<h2 id="modifiable-settings-at-runtime-via-marathon-env-vars">Modifiable settings (at runtime via Marathon env vars):</h2>

<ul>
  <li>Plugins</li>
  <li>CPU</li>
  <li>Memory</li>
  <li>JVM Heap (do not exceed ½ available node RAM)</li>
  <li>Node count (up, not down)</li>
  <li>Deployment/Upgrade strategy (serial/parallel). Note that serial deployment does not yet wait for the cluster to reach green before proceeding to the next node. This is a known limitation.</li>
</ul>

<p>Any other modifiable settings are covered by the various Elasticsearch APIs (cluster settings, index settings, templates, aliases, scripts). It’s possible that some of the more common cluster settings will get exposed in future versions of the Elastic DC/OS Service.</p>

<h1 id="viewing-plans-via-the-cli">Viewing Plans via the CLI</h1>

<p>You can view the deploy plan for the DC/OS Elastic Service via the service URL: <code class="highlighter-rouge">http://$DCOS_URL/service/$SERVICE_NAME/v1/plans</code></p>

<h1 id="topology">Topology</h1>

<p>Each task in the cluster performs one and only one of the following roles: master, data, ingest, coordinator, kibana.</p>

<p>The default placement strategy distributes all instances of the same node task type to different agents. So no two master nodes would run on the same agent, but a data node might get placed onto an agent that is also running a master node.</p>

<p><img src="img/private-nodes-by-agent.png" alt="agent" />
<img src="img/private-node-by-vip.png" alt="vip" /></p>

<p>No matter how big or small the cluster is, there will always be exactly 3 master-only nodes with <code class="highlighter-rouge">minimum_master_nodes = 2</code>.</p>

<h2 id="default-topology-with-minimum-resources-to-run-on-3-agents">Default Topology (with minimum resources to run on 3 agents)</h2>

<ul>
  <li>3 master-only nodes</li>
  <li>2 data-only nodes</li>
  <li>1 ingest-only node</li>
  <li>1 Kibana node with X-Pack installed</li>
  <li>1 coordinator node</li>
</ul>

<p>The master/data/ingest/coordinator nodes are set up to only perform their one role. That is, master nodes do not store data, and ingest nodes do not store cluster state.</p>

<h2 id="minimal-topology">Minimal Topology</h2>

<p>You can set up a minimal development/staging cluster without ingest nodes, coordinator nodes, or Kibana. You’ll still get 3 master nodes placed on 3 separate hosts. If you don’t care about replication, you can even use just 1 data node. By default, Elasticsearch creates indices with a replication factor of 1 (i.e., 1 primary shard + 1 replica), so with 1 data node, your cluster will be stuck in a ‘yellow’ state unless you change the replication factor.</p>

<p>Note that with X-Pack installed, the default monitoring behavior is to try to write to an ingest node every few seconds. Without an ingest node, you will see frequent warnings in your master node error logs. While they can be ignored, you can turn them off by disabling X-Pack monitoring in your cluster, like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -XPUT -u elastic:changeme master.elastic.l4lb.thisdcos.directory:9200/_cluster/settings -d <span class="s1">'{
    "persistent" : {
        "xpack.monitoring.collection.interval" : -1
    }
}'</span>
</code></pre>
</div>

</div>
</div>
</body>

</html>
