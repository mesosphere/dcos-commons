name: {{FRAMEWORK_NAME}}
scheduler:
  principal: {{SERVICE_PRINCIPAL}}
pods:
  master:
    count: 1
    uris:
      - {{BOOTSTRAP_URI}}
      - {{SPARK_URI}}
    tasks:
      server:
        goal: RUNNING
        cmd: "./bootstrap && $MESOS_SANDBOX/{{SPARK_VERSION}}/sbin/start-master.sh -p {{SPARK_MASTER_PORT}} --webui-port {{SPARK_MASTER_WEBUI_PORT}}"
        cpus: {{DAEMON_CPUS}}
        memory: {{DAEMON_MEM}}
        ports:
          data:
            port: {{SPARK_MASTER_PORT}}
          webui:
            port: {{SPARK_MASTER_WEBUI_PORT}}  
        configs:
          master-config:
            template: {{CONFIG_TEMPLATE_PATH}}/spark-env.sh
            dest: {{SPARK_VERSION}}/conf/spark-env.sh
          log4j:
            template: {{CONFIG_TEMPLATE_PATH}}/log4j.properties
            dest: {{SPARK_VERSION}}/conf/log4j.properties
        env:
          SPARK_NO_DAEMONIZE: true
          SPARK_MASTER_PORT: {{SPARK_MASTER_PORT}}
          SPARK_MASTER_WEBUI_PORT: {{SPARK_MASTER_WEBUI_PORT}}
  worker:
    count: {{WORKER_COUNT}}
    uris:
      - {{BOOTSTRAP_URI}}
      - {{SPARK_URI}}
    tasks:
      worker:
        goal: RUNNING
        cmd: "./bootstrap && $MESOS_SANDBOX/{{SPARK_VERSION}}/sbin/start-slave.sh master-0-server.{{FRAMEWORK_NAME}}.mesos:{{SPARK_MASTER_PORT}}"
        cpus: {{WORKER_CPUS}}
        memory: {{WORKER_MEM}}
        ports:
          data:
            port: {{SPARK_WORKER_PORT}}
          webui:
            port: {{SPARK_WORKER_WEBUI_PORT}}
        configs:
          worker-config:
            template: {{CONFIG_TEMPLATE_PATH}}/spark-env.sh
            dest: {{SPARK_VERSION}}/conf/spark-env.sh
          log4j:
            template: {{CONFIG_TEMPLATE_PATH}}/log4j.properties
            dest: {{SPARK_VERSION}}/conf/log4j.properties
        env:
          SPARK_NO_DAEMONIZE: true
          SPARK_WORKER_WEBUI_PORT: {{SPARK_WORKER_WEBUI_PORT}}
          SPARK_WORKER_PORT: {{SPARK_WORKER_PORT}}
          WORKER_CPUS: {{WORKER_CPUS}}
          WORKER_MEM: {{WORKER_MEM}}
