name: {{FRAMEWORK_NAME}}
scheduler:
  user: {{FRAMEWORK_USER}}
  principal: {{FRAMEWORK_PRINCIPAL}}
pods:
  hello-overlay-vip:
    count: 1
    # join the 'dcos' overlay network
    networks:
      dcos:
       labels: "key0:val0,key1:val1"
    image: python:3.7
    tasks:
      server:
        goal: RUNNING
        cpus: {{HELLO_CPUS}}
        memory: {{HELLO_MEM}}
        ports:
          overlay-vip:
            port: 4044
            advertise: true
            vip:
              prefix: overlay-vip
              port: 80
        cmd: |
          echo "hello from the overlay network with a VIP" > content &&
          python3 -m http.server 4044
        readiness-check:
          cmd: "curl -f -X GET overlay-vip.$FRAMEWORK_VIP_HOST:80/content >> output"
          interval: 10
          delay: 15
          timeout: 120
  hello-overlay:
    count: 1
    networks:
      dcos:
        labels:
    image: python:3.7
    tasks:
      server:
        goal: RUNNING
        cpus: {{HELLO_CPUS}}
        memory: {{HELLO_MEM}}
        ports:
          overlay-dummy:
            port: 1025
          overlay-dynport:
            port: 0
            env-key: PORT_OVERLAY_DYNPORT
        cmd: |
          echo "hello from the overlay network" > content &&
          python3 -m http.server $PORT_OVERLAY_DYNPORT
        readiness-check:
          cmd: "curl -f -X GET hello-overlay-0-server.$FRAMEWORK_HOST:1026/content >> output"
          interval: 10
          delay: 15
          timeout: 120
  hello-host-vip:
    count: 1
    image: python:3.7
    tasks:
      server:
        goal: RUNNING
        cpus: {{HELLO_CPUS}}
        memory: {{HELLO_MEM}}
        ports:
          host-vip:
            port: 4044
            advertise: true
            vip:
              prefix: host-vip
              port: 80
        cmd: |
          echo "hello from the host network with a VIP" > content &&
          python3 -m http.server 4044
        readiness-check:
          cmd: "curl -f -X GET host-vip.$FRAMEWORK_VIP_HOST:80/content >> output"
          interval: 10
          delay: 15
          timeout: 120
  hello-host:
    count: 1
    image: python:3.7
    tasks:
      server:
        goal: RUNNING
        cpus: {{HELLO_CPUS}}
        memory: {{HELLO_MEM}}
        ports:
          host-port:
            port: 4044
        cmd: |
          echo "hello from the host network" > content &&
          python3 -m http.server 4044
        readiness-check:
          cmd: "curl -f -X GET hello-host-0-server.$FRAMEWORK_HOST:4044/content >> output"
          interval: 10
          delay: 15
          timeout: 120
  getter:
    count: {{HELLO_COUNT}}
    networks:
      dcos:
    tasks:
      check-comm:
        goal: ONCE
        cpus: {{HELLO_CPUS}}
        memory: {{HELLO_MEM}}
        cmd: |
          curl -f -X GET overlay-vip.$FRAMEWORK_VIP_HOST:80/content >> output &&
          curl -f -X GET hello-overlay-0-server.$FRAMEWORK_HOST:1026/content >> output &&
          curl -f -X GET host-vip.$FRAMEWORK_VIP_HOST:80/content >> output &&
          curl -f -X GET hello-host-0-server.$FRAMEWORK_HOST:4044/content >> output &&
          date >> success
        readiness-check:
          cmd: "if [ ! -f success ]; then echo 'no success file' && exit 1; fi"
          interval: 10
          delay: 15
          timeout: 120


