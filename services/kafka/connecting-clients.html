<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">








<head>
<title>Kafka: Connecting Clients</title>
<link rel="stylesheet" type="text/css" media="all" href="../../style/layout.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="../../style/Dropdown.css" />
<script src="../../style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
.section-nav ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="../..">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="../..">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      
      <li><a href="../../operations-guide.html">SDK Operations Guide</a></li>
      
      
      
      
      
      <li><a href="../../developer-guide.html">SDK Developer Guide</a></li>
      
      
      
      <li><a href="../../yaml-reference.html">YAML Reference</a></li>
      
      
      
      <li><a href="../../faq.html">Frequently Asked Questions</a></li>
      
      
      
      <li><a href="../../glossary.html">Glossary</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li><a href="../../reference/api">Javadoc Reference</a></li>
      <li><a href="../../reference/swagger-api">REST APIs</a></li>
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="../../tutorials/secrets-tutorial.html">Secrets Tutorial</a></li>
      
      <li><a href="../../tutorials/kafka-tutorial.html">Kafka Tutorial</a></li>
      
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Cassandra</span>
        
        <ul>
          
          
          
          <li><a href="../../services/cassandra/install.html">Install and Customize</a></li>
          
          
          
          <li><a href="../../services/cassandra/service-settings.html">Service Settings</a></li>
          
          
          
          <li><a href="../../services/cassandra/cassandra-settings.html">Cassandra Settings</a></li>
          
          
          
          <li><a href="../../services/cassandra/node-settings.html">Node Settings</a></li>
          
          
          
          <li><a href="../../services/cassandra/uninstall.html">Uninstall</a></li>
          
          
          
          <li><a href="../../services/cassandra/quick-start.html">Quick Start</a></li>
          
          
          
          <li><a href="../../services/cassandra/connecting-clients.html">Connecting Clients</a></li>
          
          
          
          <li><a href="../../services/cassandra/managing.html">Managing</a></li>
          
          
          
          <li><a href="../../services/cassandra/api-reference.html">API Reference</a></li>
          
          
          
          <li><a href="../../services/cassandra/disaster-recovery.html">Disaster Recovery</a></li>
          
          
          
          <li><a href="../../services/cassandra/troubleshooting.html">Troubleshooting</a></li>
          
          
          
          <li><a href="../../services/cassandra/limitations.html">Limitations</a></li>
          
          
          
          <li><a href="../../services/cassandra/supported-versions.html">Supported Versions</a></li>
          
          
          
          <li><a href="../../services/cassandra/release-notes.html">Release Notes</a></li>
          
          
          
          <li><a href="../../services/cassandra/upgrade.html">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          
          <li><a href="../../services/elastic/install.html">Install and Customize</a></li>
          
          
          
          <li><a href="../../services/elastic/elastic-x-pack.html">X-Pack</a></li>
          
          
          
          <li><a href="../../services/elastic/custom-elasticsearch-yaml.html">Custom Elasticsearch YAML</a></li>
          
          
          
          <li><a href="../../services/elastic/uninstall.html">Uninstall</a></li>
          
          
          
          <li><a href="../../services/elastic/quick-start.html">Quick Start</a></li>
          
          
          
          <li><a href="../../services/elastic/connecting-clients.html">Connecting Clients</a></li>
          
          
          
          <li><a href="../../services/elastic/managing.html">Managing</a></li>
          
          
          
          <li><a href="../../services/elastic/api-reference.html">API Reference</a></li>
          
          
          
          <li><a href="../../services/elastic/disaster-recovery.html">Disaster Recovery</a></li>
          
          
          
          <li><a href="../../services/elastic/troubleshooting.html">Troubleshooting</a></li>
          
          
          
          <li><a href="../../services/elastic/limitations.html">Limitations</a></li>
          
          
          
          <li><a href="../../services/elastic/supported-versions.html">Supported Versions</a></li>
          
          
          
          <li><a href="../../services/elastic/release-notes.html">Release Notes</a></li>
          
          
          
          <li><a href="../../services/elastic/upgrade.html">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          
          <li><a href="../../services/hdfs/install.html">Install and Customize</a></li>
          
          
          
          <li><a href="../../services/hdfs/kerberos.html">Kerberos</a></li>
          
          
          
          <li><a href="../../services/hdfs/uninstall.html">Uninstall</a></li>
          
          
          
          <li><a href="../../services/hdfs/quick-start.html">Quick Start</a></li>
          
          
          
          <li><a href="../../services/hdfs/connecting-clients.html">Connecting Clients</a></li>
          
          
          
          <li><a href="../../services/hdfs/managing.html">Managing</a></li>
          
          
          
          <li><a href="../../services/hdfs/api-reference.html">API Reference</a></li>
          
          
          
          <li><a href="../../services/hdfs/troubleshooting.html">Troubleshooting</a></li>
          
          
          
          <li><a href="../../services/hdfs/limitations.html">Limitations</a></li>
          
          
          
          <li><a href="../../services/hdfs/supported-versions.html">Supported Versions</a></li>
          
          
          
          <li><a href="../../services/hdfs/release-notes.html">Release Notes</a></li>
          
          
          
          <li><a href="../../services/hdfs/upgrade.html">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          
          <li><a href="../../services/kafka/install.html">Install and Customize</a></li>
          
          
          
          <li><a href="../../services/kafka/security.html">Security</a></li>
          
          
          
          <li><a href="../../services/kafka/uninstall.html">Uninstall</a></li>
          
          
          
          <li><a href="../../services/kafka/quick-start.html">Quick Start</a></li>
          
          
          
          <li><a href="../../services/kafka/connecting-clients.html">Connecting Clients</a></li>
          
          
          
          <li><a href="../../services/kafka/managing.html">Managing</a></li>
          
          
          
          <li><a href="../../services/kafka/api-reference.html">API Reference</a></li>
          
          
          
          <li><a href="../../services/kafka/troubleshooting.html">Troubleshooting</a></li>
          
          
          
          <li><a href="../../services/kafka/limitations.html">Limitations</a></li>
          
          
          
          <li><a href="../../services/kafka/supported-versions.html">Supported Versions</a></li>
          
          
          
          <li><a href="../../services/kafka/release-notes.html">Release Notes</a></li>
          
          
          
          <li><a href="../../services/kafka/upgrade.html">Upgrade</a></li>
          
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Kafka: Connecting Clients</h1>
<div id="content">

<h1 id="supported-client-libraries">Supported Client Libraries</h1>

<ul>
  <li>The official Kafka Java library, i.e., <code class="highlighter-rouge">org.apache.kafka.clients.consumer.KafkaConsumer</code> and <code class="highlighter-rouge">org.apache.kafka.clients.producer.KafkaProducer</code>.</li>
</ul>

<p>Through Confluent:</p>
<ul>
  <li>Go</li>
  <li>C++</li>
  <li>Python</li>
  <li>.NET</li>
</ul>

<h1 id="kafka-client-api-compatibility">Kafka Client API Compatibility</h1>

<ol>
  <li>The Kafka client protocol is versioned and the cluster supports multiple versions.</li>
  <li>Kafka is backwards compatible: Newer versions of Kafka always continue to support older versions of the protocol. The implication of this is older clients continue to work with newer versions of Kafka.</li>
  <li>Clients are not forward compatible: There is no effort to have newer versions of the client support older versions of Kafka the protocol. The implication of this is newer clients are not compatible older versions of Kafka.</li>
</ol>

<h1 id="using-the-dcos-cli">Using the DC/OS CLI</h1>

<p>The following command can be executed from the cli in order to retrieve a set of brokers to connect to.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-kafka <span class="nt">--name</span><span class="o">=</span>kafka endpoints broker
</code></pre></div></div>

<p><a name="using-the-rest-api"></a></p>
<h1 id="using-the-rest-api">Using the REST API</h1>

<p>REST API requests must be authenticated. See the REST API Authentication part of the REST API Reference for more information.</p>

<p>The following <code class="highlighter-rouge">curl</code> example demonstrates how to retrive connection a set of brokers to connect to using the REST API.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-H</span> <span class="s2">"Authorization: token=</span><span class="nv">$auth_token</span><span class="s2">"</span> <span class="s2">"&lt;dcos_url&gt;/service/kafka/v1/endpoints/broker"</span>
</code></pre></div></div>

<h2 id="user-token-authentication">User token authentication</h2>

<p>DC/OS Enterprise Edition comes with support for <a href="https://docs.mesosphere.com/1.9/security/users-groups/">user ACLs</a>. To interact with the Kafka REST API you must first retrieve an auth token from the <a href="https://docs.mesosphere.com/1.9/security/iam-api/">auth HTTP endpoint</a>, then provide this token in following requests.</p>

<p>First, we retrieve <code class="highlighter-rouge">uSeR_t0k3n</code> with our user credentials and store the token as an environment variable:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--data</span> <span class="s1">'{"uid":"username", "password":"password"}'</span> <span class="nt">-H</span> <span class="s2">"Content-Type:application/json"</span> <span class="s2">"&lt;dcos_url&gt;/acs/api/v1/auth/login"</span>
<span class="o">{</span>
  <span class="s2">"token"</span>: <span class="s2">"uSeR_t0k3n"</span>
<span class="o">}</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">auth_token</span><span class="o">=</span>uSeR_t0k3n
</code></pre></div></div>

<p>Then, use this token to authenticate requests to the Kafka Service:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-H</span> <span class="s2">"Authorization: token=</span><span class="nv">$auth_token</span><span class="s2">"</span> <span class="s2">"&lt;dcos_url&gt;/service/kafka/v1/endpoints/broker"</span>
</code></pre></div></div>

<p>You do not need the token to access the Kafka brokers themselves.</p>

<h1 id="connection-info-response">Connection Info Response</h1>

<p>The response, for both the CLI and the REST API is as below.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"10.0.0.49:1025"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"10.0.2.253:1025"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"10.0.1.27:1025"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"dns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"kafka-2-broker.kafka.autoip.dcos.thisdcos.directory:1025"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"kafka-0-broker.kafka.autoip.dcos.thisdcos.directory:1025"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"kafka-1-broker.kafka.autoip.dcos.thisdcos.directory:1025"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"vip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"broker.kafka.l4lb.thisdcos.directory:9092"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This JSON array contains a list of valid brokers that the client can use to connect to the Kafka cluster. For availability reasons, it is best to specify multiple brokers in configuration of the client. Use the VIP to address any one of the Kafka brokers in the cluster. <a href="https://docs.mesosphere.com/1.9/networking/">Learn more about load balancing and VIPs in DC/OS</a>.</p>

<p>When <a href="https://docs.mesosphere.com/services/beta-kafka/configure/#tls">the TLS</a> is enabled you can request details for <code class="highlighter-rouge">broker-tls</code> port. To verify a TLS connection from a client the <a href="https://docs.mesosphere.com/1.9/networking/tls-ssl/get-cert/">DC/OS trust bundle with a CA certificate</a> is required.</p>

<h1 id="configuring-the-kafka-client-library">Configuring the Kafka Client Library</h1>

<h2 id="adding-the-kafka-client-library-to-your-application">Adding the Kafka Client Library to Your Application</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.kafka<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>kafka-clients<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>0.9.0.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>The above is the correct dependency for the Kafka Client Library to use with the DC/OS Kafka service. After adding this dependency to your project, you should have access to the correct binary dependencies to interface with the Kafka Cluster.</p>

<h2 id="connecting-the-kafka-client-library">Connecting the Kafka Client Library</h2>

<p>The code snippet below demonstrates how to connect a Kafka Producer to the cluster and perform a loop of simple insertions.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">org.apache.kafka.clients.producer.KafkaProducer</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.kafka.clients.producer.ProducerRecord</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.kafka.common.serialization.ByteArraySerializer</span><span class="o">;</span>

    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">producerConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">producerConfig</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bootstrap.servers"</span><span class="o">,</span> <span class="s">"10.0.0.211:9843,10.0.0.217:10056,10.0.0.214:9689"</span><span class="o">);</span>
    <span class="c1">// optional:</span>
    <span class="n">producerConfig</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"metadata.fetch.timeout.ms"</span><span class="o">:</span> <span class="s">"3000"</span><span class="o">);</span>
    <span class="n">producerConfig</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"request.timeout.ms"</span><span class="o">,</span> <span class="s">"3000"</span><span class="o">);</span>
    <span class="c1">// ... other options: http://kafka.apache.org/documentation.html#producerconfigs</span>
    <span class="n">ByteArraySerializer</span> <span class="n">serializer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArraySerializer</span><span class="o">();</span>
    <span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">kafkaProducer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KafkaProducer</span><span class="o">&lt;&gt;(</span><span class="n">producerConfig</span><span class="o">,</span> <span class="n">serializer</span><span class="o">,</span> <span class="n">serializer</span><span class="o">);</span>

    <span class="kt">byte</span><span class="o">[]</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">message</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">message</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="sc">'x'</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">message</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="sc">'o'</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">ProducerRecord</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">record</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerRecord</span><span class="o">&lt;&gt;(</span><span class="s">"test-topic"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">kafkaProducer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">record</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>The code snippet below demonstrates how to connect a Kafka Consumer to the cluster and perform a simple retrievals.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">import</span> <span class="nn">org.apache.kafka.clients.consumer.ConsumerRecord</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.kafka.clients.consumer.ConsumerRecords</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.kafka.clients.consumer.KafkaConsumer</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">org.apache.kafka.common.serialization.ByteArrayDeserializer</span><span class="o">;</span>

    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">consumerConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">consumerConfig</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bootstrap.servers"</span><span class="o">,</span> <span class="s">"10.0.0.211:9843,10.0.0.217:10056,10.0.0.214:9689"</span><span class="o">);</span>
    <span class="c1">// optional:</span>
    <span class="n">consumerConfig</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"group.id"</span><span class="o">,</span> <span class="s">"test-client-consumer"</span><span class="o">)</span>
    <span class="c1">// ... other options: http://kafka.apache.org/documentation.html#consumerconfigs</span>
    <span class="n">ByteArrayDeserializer</span> <span class="n">deserializer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayDeserializer</span><span class="o">();</span>
    <span class="n">KafkaConsumer</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">kafkaConsumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KafkaConsumer</span><span class="o">&lt;&gt;(</span><span class="n">consumerConfig</span><span class="o">,</span> <span class="n">deserializer</span><span class="o">,</span> <span class="n">deserializer</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">topics</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="n">topics</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"test-topic"</span><span class="o">);</span>
    <span class="n">kafkaConsumer</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">topics</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ConsumerRecords</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">records</span> <span class="o">=</span> <span class="n">kafkaConsumer</span><span class="o">.</span><span class="na">poll</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
      <span class="kt">int</span> <span class="n">bytes</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">ConsumerRecord</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">record</span> <span class="o">:</span> <span class="n">records</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">bytes</span> <span class="o">+=</span> <span class="n">record</span><span class="o">.</span><span class="na">key</span><span class="o">().</span><span class="na">length</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">bytes</span> <span class="o">+=</span> <span class="n">record</span><span class="o">.</span><span class="na">value</span><span class="o">().</span><span class="na">length</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Got %d messages (%d bytes)"</span><span class="o">,</span> <span class="n">records</span><span class="o">.</span><span class="na">count</span><span class="o">(),</span> <span class="n">bytes</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="n">kafkaConsumer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div></div>

<h1 id="configuring-the-kafka-test-scripts">Configuring the Kafka Test Scripts</h1>

<p>The following code connects to a DC/OS-hosted Kafka instance using <code class="highlighter-rouge">bin/kafka-console-producer.sh</code> and <code class="highlighter-rouge">bin/kafka-console-consumer.sh</code> as an example:</p>

<pre><code class="language-bvash">$ dcos beta-kafka --name=kafka endpoints broker
{
  "address": [
    "10.0.0.49:1025",
    "10.0.2.253:1025",
    "10.0.1.27:1025"
  ],
  "dns": [
    "kafka-2-broker.kafka.autoip.dcos.thisdcos.directory:1025",
    "kafka-0-broker.kafka.autoip.dcos.thisdcos.directory:1025",
    "kafka-1-broker.kafka.autoip.dcos.thisdcos.directory:1025"
  ],
  "vip": "broker.kafka.l4lb.thisdcos.directory:9092"
}

$ dcos node ssh --master-proxy --leader

core@ip-10-0-6-153 ~ $ docker run -it mesosphere/kafka-client

root@7d0aed75e582:/bin# echo "Hello, World." | ./kafka-console-producer.sh --broker-list 10.0.0.49:1025, 10.0.2.253:1025, 10.0.1.27:1025 --topic topic1

root@7d0aed75e582:/bin# ./kafka-console-consumer.sh --zookeeper master.mesos:2181/dcos-service-kafka --topic topic1 --from-beginning
    Hello, World.
</code></pre>

</div>
</div>
</body>

</html>
